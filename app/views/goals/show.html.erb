<div class="goal-show-container">
  <h1><%= @goal.name %></h1>
</div>
<%= link_to "â¬…ï¸ Retour au dashboard", dashboard_path, class: "btn btn-secondary mt-3" %>

<!-- Progression -->
<div class="progress-container">
  <% total = @goal.badges.count %>
  <% done = @validated_badges.count { |id| @goal.badges.pluck(:id).include?(id) } %>
  <% percent = total.zero? ? 0 : ((done.to_f / total) * 100).round %>

  <div class="progress-bar" style="width: <%= percent %>%"></div>
  <div class="progress-text"><%= percent %>%</div>
</div>

<div class="trophy-list">
  <% @badges.each do |badge| %>
    <div class="trophy-card">
      <div class="trophy-card-text">
        <h3><%= badge.title %></h3>

        <p><%= badge.description %></p>
      </div>

      <div class="trophy-card-action">
        <% if @validated_badges.include?(badge.id) %>
          <span class="validated">âœ”</span>
        <% else %>
          <%= button_to user_badges_path(badge_id: badge.id),
                method: :post,
                class: "validate-btn" do %>
            <%= image_tag "icon-trophy-small.svg", class: "validate-icon" %>
          <% end %>
        <% end %>
      </div>
    </div>
  <% end %>
</div>

<h3>Photos inspirantes</h3>

<%= form_with url: "/goals/#{@goal.id}/photos",
              method: :post,
              local: true,
              html: { multipart: true, class: "upload-form" } do %>

  <label for="photos-input" class="custom-upload-button">
    ðŸ“· <span>Ajouter des photos</span>
  </label>

  <%= file_field_tag "photos[]",
      id: "photos-input",
      multiple: true,
      onchange: "this.form.submit()",
      style: "display:none;" %>

<% end %>

<div class="photos-carousel">
  <% @goal.photos.each do |photo| %>
    <%= link_to "/goals/#{@goal.id}/gallery" do %>
      <%= image_tag photo, height: 120 %>
    <% end %>
  <% end %>
</div>

<div id="trophy-popup"
     class="trophy-popup"
     data-controller="trophy-popup"
     data-trophy-popup-show-value="<%= flash[:notice] == 'trophy_unlocked' %>">

  <div class="trophy-popup-content">
    <h2>ðŸŽ‰ FÃ©licitations LÃ©o !</h2>
    <p>Vous avez dÃ©bloquÃ© un nouveau trophy.</p>

    <div class="popup-buttons">
      <button class="popup-close" data-action="trophy-popup#close">OK</button>

      <button class="popup-share">
        Partager Ã  un ami
      </button>
    </div>
  </div>

</div>
